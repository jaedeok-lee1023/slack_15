import os
import sys
import datetime
import arrow
from dotenv import load_dotenv
from slack_sdk import WebClient
from slack_sdk.errors import SlackApiError
from kurly import clusters

# ğŸ¯ í•œêµ­ ê³µíœ´ì¼ ëª©ë¡ (YYYY-MM-DD í˜•ì‹)
HOLIDAYS = {
    "2026-01-01",  # ì‹ ì •
    "2026-02-16",  # ì„¤ ì—°íœ´
    "2026-02-17",  # ì„¤ë‚ 
    "2026-02-18",  # ì„¤ ì—°íœ´
    "2026-03-02",  # ëŒ€ì²´ê³µíœ´ì¼
    "2026-05-05",  # ì–´ë¦°ì´ë‚ 
    "2026-05-25",  # ëŒ€ì²´ê³µíœ´ì¼
    "2026-06-03",  # ì§€ë°©ì„ ê±°
    "2026-08-17",  # ëŒ€ì²´ê³µíœ´ì¼
    "2026-09-24",  # ì¶”ì„ ì—°íœ´
    "2026-09-25",  # ì¶”ì„
    "2026-10-05",  # ëŒ€ì²´ê³µíœ´ì¼
    "2026-10-09",  # í•œê¸€ë‚ 
    "2026-12-25",  # í¬ë¦¬ìŠ¤ë§ˆìŠ¤
}

# ğŸ“† ì˜¤ëŠ˜ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
today = datetime.date.today().strftime("%Y-%m-%d")

# ğŸš« ì˜¤ëŠ˜ì´ ê³µíœ´ì¼ì´ë©´ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì¢…ë£Œ
if today in HOLIDAYS:
    print(f"ğŸ“¢ ì˜¤ëŠ˜({today})ì€ ê³µíœ´ì¼ì´ë¯€ë¡œ ì‹¤í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    sys.exit(0)

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ Slack í† í° ë¡œë“œ
load_dotenv()
SLACK_TOKEN = os.environ.get("SLACK_TOKEN")

def send_slack_message(message, channel):
    try:
        client = WebClient(token=SLACK_TOKEN)
        client.chat_postMessage(channel=channel, text=message)
    except SlackApiError as e:
        print(f"âš ï¸ Error sending message to {channel} : {e}")

def main():
    for cluster in clusters:
        # ë©”ì‹œì§€ ì œëª© ì„¤ì •
        header = f"*[ê³µì§€ï½œì‚¬ë‚´ ì¶”ì²œì œë„ ì•ˆë‚´]*\n\n\n"

        notice_msg = (
            f"1. *ì¤‘ìš”ë„* : ì¤‘\n"
            f"2. *ëŒ€ìƒ* : í‰íƒ í´ëŸ¬ìŠ¤í„° ì„ì§ì› ì „ì²´\n"
            f"3. *ì£¼ìš” ë‚´ìš©*\n\n"
            f"\n"
            f"ì•ˆë…•í•˜ì„¸ìš”? í‰íƒ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì› ì—¬ëŸ¬ë¶„!:blush:\n\n"
            f"ê¸°ì¡´ ì‚¬ë‚´ ì¶”ì²œì±„ìš© ë°©ì‹ì„ :arrow_forward: *ì˜¨ë¼ì¸ ê°„í¸ ì§€ì›* :arrow_backward: ìœ¼ë¡œ ê°œí¸ ë˜ì—ˆìŠµë‹ˆë‹¤.\n"
            f"ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ ì£¼ë³€ì— *ì»¬ë¦¬ì™€ ì˜ ë§ëŠ” ì¸ì¬ê°€ ìˆë‹¤ë©´, ì˜¨ë¼ì¸ ì¶”ì²œì„œë¥¼ ì œì¶œí•˜ì—¬ *ì¶”ì²œ ì±„ìš© ë³´ìƒê¸ˆ* ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì¡ìœ¼ì„¸ìš”!:ê°ì‚¬ì½©gif:\n\n"
            f"\n"
            f":bulb: *ì‚¬ë‚´ì¶”ì²œì œë„ë€?*\n"
            f">ì»¬ë¦¬ êµ¬ì„±ì›ì´ ì¸ì¬ë¥¼ ì¶”ì²œí•˜ë©´, ì¶”ì²œë°›ì€ ì§€ì›ìê°€ ì…ì‚¬ í›„ ì¼ì • ê¸°ê°„ ê·¼ì† ì‹œ *ì¶”ì²œìì—ê²Œ ë³´ìƒê¸ˆ* ì´ ì§€ê¸‰ë˜ëŠ” ì œë„ ì…ë‹ˆë‹¤!\n"
            f">ì¶”ì²œ ì±„ìš© ë³´ìƒê¸ˆì˜ ê²½ìš° ì…ì‚¬ ì ˆì°¨ì— ë§ì¶° ê´€ë ¨ ë¶€ì„œ ê²€í†  í›„ ì•„ë˜ ê·¼ì†ê°œì›”ì— ë”°ë¼ ë³´ìƒê¸ˆì´ ì§€ê¸‰ ë©ë‹ˆë‹¤.\n\n"
            f">( *ìì„¸í•œ ì•ˆë‚´ ì‚¬í•­* ì€ *<https://kurlyptrc.notion.site/5eb394b593ac4784bc4dc4a3ff82087a|ì¶”ì²œ ì±„ìš© ì œë„ ì•ˆë‚´>* ì—ì„œ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤ )\n\n"
            f"\n"
            f":pushpin: *ì¶”ì²œ ì±„ìš© ë³´ìƒ ì•ˆë‚´*\n"
            f">:ck11: ì„ ì„/ì‚¬ì›/ìŠ¤íƒ­(ê³„ì•½ì§) : (ì§/ê°„ì ‘ ì¶”ì²œ ë™ì¼) *ì¶”ì²œ ëŒ€ìƒì ê·¼ì† 3ê°œì›” í›„ 300,000ì›*\n"
            f">:ck11: ìŠ¤íƒ­(ì •ê·œì§) ì´ìƒ : (ê°„ì ‘ ì¶”ì²œ) *ì¶”ì²œ ëŒ€ìƒì ê·¼ì† 3ê°œì›” í›„ 500,000ì›*\n"
            f">:ck11: ìŠ¤íƒ­(ì •ê·œì§) ì´ìƒ : (ì§ì ‘ ì¶”ì²œ) *ì¶”ì²œ ëŒ€ìƒì ê·¼ì† 3ê°œì›” í›„ 500,000ì› / ì¶”ì²œëŒ€ìƒì ê·¼ì† 6ê°œì›” í›„ 500,000ì›*\n\n"
            f"\n"
            f":purple_heart: *ì±„ìš© ë° ì¶”ì²œ ê´€ë ¨ ë¬¸ì˜* :purple_heart:\n"
            f"*:slack: ë¬¸ì˜ì‚¬í•­ : <@U094ZMCF1T2>,<@U05P7LCBQ8H>\n"
            f":phone:  *010-5820-6937*\n\n"
            f"\n"
            f"ê°ì‚¬í•©ë‹ˆë‹¤.\n"
        )
 
# ë©”ì‹œì§€ ë³¸ë¬¸
        body = header + notice_msg

        # ìŠ¬ë™ ì±„ë„ì— ì „ì†¡
        send_slack_message(body, cluster.channel)

if __name__ == "__main__":
    main()
